---
import BaseHead from "@/components/BaseHead.astro";
import Header from "@/components/Header.astro";
import Footer from "@/components/Footer.astro";
import CardStackable from "@/components/CardStackable.astro";
import CardFeatured from "@/components/CardFeatured.astro";
import CardWrapper from "@/components/CardWrapper.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "@/consts";
import { getCollection } from "astro:content";
import CollaborateCard from "@/components/CollaborateCard.astro";

const featuredBlogs = await getCollection("blog", ({ data }) => {
  return data.featured === true;
});

const placeholderBlogPosts = [
  {
    title: "Getting Started with Astro.js",
    description:
      "Learn how to kickstart your development journey with Astro.js.",
    tag: "Astro.js",
    url: "https://example.com/getting-started-with-astro-js",
  },
  {
    title: "Advanced Techniques in Astro.js",
    description:
      "Explore advanced tips and tricks to take your Astro.js skills to the next level.",
    tag: "Astro.js",
    url: "https://example.com/advanced-techniques-in-astro-js",
  },
  {
    title: "Introduction to Reactive Programming",
    description:
      "Discover the fundamentals of reactive programming and its applications in modern web development.",
    tag: "Reactive Programming",
    url: "https://example.com/introduction-to-reactive-programming",
  },
];
---

<html lang="en">
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <style>
      @keyframes ticker-scroll {
        from {
          transform: translateX(0);
        }
        to {
          transform: translateX(-50%);
        }
      }
      .ticker-track.is-animated {
        animation: ticker-scroll 10s linear infinite;
      }
      .ticker-track > .ticker-divider {
        opacity: 0.35;
      }
      @keyframes live-pulse {
        0% {
          opacity: 0.2;
          transform: scale(0.85);
        }
        50% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0.2;
          transform: scale(0.85);
        }
      }
      .live-dot {
        animation: live-pulse 1.2s ease-in-out infinite;
      }
    </style>
  </head>
  <body>
    <section class="my-8 max-w-[1240px] mx-auto px-4">
      <Header />
      <div class="w-full">
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-stretch">
          <CardWrapper class="md:col-span-3">
            <img
              src="/headshot.png"
              loading="lazy"
              width="100"
              alt="Kevin Herrera headshot"
              class="rounded-full"
            />
            <div>
              <h1>Kevin Herrera</h1>
              <p class="text-3xl">
                is a Frontend Engineer and designer by trade. Collaboration and
                creating is his passion. Currently creating & collaborating at
                <span class="cloudflare-orange">
                  <a href="https://www.cloudflare.com" target="_blank"
                    >Cloudflare</a
                  >
                </span>
              </p>
            </div>
          </CardWrapper>
          <div class="md:col-span-2">
            <CollaborateCard />
          </div>
        </div>
        <CardWrapper
          class="news-ticker-container col-span-5 row-start-2 py-4 px-8 my-4"
        >
          <div
            class="ticker flex items-center gap-4"
            data-endpoint="/api/ticker.json"
          >
            <div
              class="shrink-0 flex items-center gap-2 text-xs font-semibold uppercase tracking-widest text-gray-500"
            >
              <span class="live-dot inline-block h-2.5 w-2.5 rounded-full bg-red-600"></span>
              <span>Live</span>
            </div>
            <div class="relative w-full overflow-hidden">
              <div
                class="ticker-track flex items-center gap-8 whitespace-nowrap text-sm md:text-base"
              >
                <span class="text-gray-500">Loading ticker...</span>
              </div>
            </div>
          </div>
          <script is:inline>
            const tickerRoot = document.querySelector(
              ".news-ticker-container [data-endpoint]",
            );
            const track = tickerRoot?.querySelector(".ticker-track");
            if (tickerRoot && track) {
              const endpoint = tickerRoot.getAttribute("data-endpoint");

              const formatChange = (value) => {
                if (typeof value !== "number" || Number.isNaN(value)) return "";
                const sign = value > 0 ? "+" : "";
                return `${sign}${value.toFixed(2)}%`;
              };

              const renderItems = (items) => {
                track.innerHTML = "";
                if (!items?.length) {
                  track.innerHTML =
                    '<span class="text-gray-500">No live updates available.</span>';
                  track.classList.remove("is-animated");
                  return;
                }

                items.forEach((item, index) => {
                  const wrapper = document.createElement("span");
                  wrapper.className =
                    "ticker-item inline-flex items-center gap-2";

                  const label = document.createElement("span");
                  label.className = "font-semibold text-gray-700";
                  label.textContent = item.label;
                  wrapper.appendChild(label);

                  const value = document.createElement("span");
                  value.className = "text-gray-600";
                  value.textContent = item.value;
                  wrapper.appendChild(value);

                  if (typeof item.change === "number") {
                    const change = document.createElement("span");
                    const isPositive = item.change >= 0;
                    change.className = isPositive
                      ? "text-green-600"
                      : "text-red-600";
                    change.textContent = formatChange(item.change);
                    wrapper.appendChild(change);
                  }

                  track.appendChild(wrapper);

                  // Always add divider after each item (needed for seamless loop)
                  const divider = document.createElement("span");
                  divider.className = "ticker-divider";
                  divider.textContent = "|";
                  track.appendChild(divider);
                });

                track.innerHTML += track.innerHTML;
                track.classList.add("is-animated");
              };

              const loadTicker = async () => {
                try {
                  const response = await fetch(endpoint, { cache: "no-store" });
                  if (!response.ok) throw new Error("Ticker fetch failed");
                  const data = await response.json();
                  renderItems(data.items);
                } catch (error) {
                  renderItems([
                    {
                      label: "Ticker",
                      value: "Unavailable (check API keys)",
                    },
                  ]);
                }
              };

              loadTicker();
              setInterval(loadTicker, 60_000);
            }
          </script>
        </CardWrapper>
        <div class="grid md:grid-cols-3 grid-rows-1 gap-4">
          <CardWrapper>
            <span class="text-7xl">ü§òüèæ</span>
            <h3 class="text-5xl">
              Based in <br /> Austin, Texas <br /> GMT-6
            </h3>
          </CardWrapper>
          <CardWrapper class="md:col-span-2">
            <p class="h3 text-3xl">
              As a software engineer, I specialize in developing unique and
              user-friendly digital products. I believe that a successful
              software starts with a solid foundation, clear communication, and
              a deep understanding of the end user's needs.
            </p>
          </CardWrapper>
        </div>
      </div>
      <div class="w-full my-4">
        <div class="grid md:grid-cols-2 grid-rows-1 gap-4">
          <div class="single-card-container">
            <CardFeatured {...placeholderBlogPosts[0]} />
          </div>
          <div class="flex flex-col justify-between items-start gap-8">
            {placeholderBlogPosts.map((post) => <CardStackable {...post} />)}
            <a
              href="/blog"
              class="text-center py-3 px-16 rounded-lg bg-bluePrimary text-white text-base font-medium flex items-center space-x-1"
            >
              <span>View all blogs</span>
              <svg
                width="11"
                height="11"
                viewBox="0 0 11 11"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M10.75 1C10.75 0.585786 10.4142 0.25 10 0.25L3.25 0.25C2.83579 0.25 2.5 0.585786 2.5 1C2.5 1.41421 2.83579 1.75 3.25 1.75L9.25 1.75L9.25 7.75C9.25 8.16421 9.58579 8.5 10 8.5C10.4142 8.5 10.75 8.16421 10.75 7.75L10.75 1ZM9.46967 0.46967L0.46967 9.46967L1.53033 10.5303L10.5303 1.53033L9.46967 0.46967Z"
                  fill="white"></path>
              </svg>
            </a>
          </div>
        </div>
      </div>
      <Footer />
    </section>
  </body>
</html>
